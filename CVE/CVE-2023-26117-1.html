<!DOCTYPE html>
<html>
  <head>
    <title>
      AngularJS vulnerability: `input[url]` validation ReDoS
    </title>

    <meta name="author" content="XLTS.dev" />
    <meta
      name="description"
      content="A minimal reproduction of an AngularJS ReDoS vulnerability related to `input[url]` validation."
    />

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="../build/angular.js"></script>
    <script src="CVE-2023-26117-1.js"></script>
    <link rel="stylesheet" href="CVE-2023-26117.css" />
  </head>

  <body>
    <h1>
      <small>Reproduction of AngularJS vulnerability:</small><br />
      <code>input[url]</code> validation ReDoS
    </h1>

    <section class="vulnerability-info-section">
      <h2>Vulnerability information</h2>
      <table class="vulnerability-info-table">
        <tr>
          <th>CVE:</th>
          <td><a href="https://www.cve.org/CVERecord?id=CVE-2023-26118">CVE-2023-26118</a></td>
        </tr>
        <tr>
          <th>Type:</th>
          <td><a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">ReDoS</a></td>
        </tr>
        <tr>
          <th>Affected versions:</th>
          <td>>=v1.4.9</td>
        </tr>
        <tr>
          <th>Fixed in version:</th>
          <td><a href="https://xlts.dev/angularjs">XLTS for AngularJS</a> v1.9.1 and v1.5.17</td>
        </tr>
        <tr>
          <th>Description:</th>
          <td>
            A regular expression used to validate the value of the <a href="https://docs.angularjs.org/api/ng/input/input%5Burl%5D"><code>input[url]</code></a> directive is vulnerable to super-linear runtime due to backtracking.
            With a large carefully-crafted input, this can result in catastrophic backtracking and cause a denial of service of the application, also known as a <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">ReDoS attack</a>.
          </td>
        </tr>
      </table>
    </section>

    <section class="repro-instructions-section">
      <h2>Reproduction instructions</h2>
      <p>
        The app below demonstrates the issue by filling an <code>&lt;input type="url"&gt;</code> element with a user-provided invalid URL and then running AngularJS' built-in URL validation logic.
      </p>
      <p>
        It is essentially the equivalent of:
        <pre>
          &lt;input type="url" ng-model="userProvidedUrl" />
        </pre>
      </p>
      <p>
        In order to make it easier to measure and observe the issue, the built-in validation logic is disabled and validation is run on demand (see instructions below).
        In a regular app, the validation logic would run as soon as a value would be entered into the <code>&lt;input&gt;</code> element.
      </p>
      <p>
        <b>Steps:</b>
        <ol>
          <li>
            Set the URL to a value containing any scheme (for example, <code>http:</code>) followed by many slashes (<code>/</code>).
          </li>
          <li>
            You can click one of the available buttons to set the URL to a value with many trailing slashes.
          </li>
          <li>
            Click the "Validate URL" button to trigger the built-in URL validation of <code>input[url]</code>.<br />
            <blockquote>
              ðŸ“Œ <b>NOTICE:</b>
              <i>The tab will be unresponsive while the URL is being validated. The more slashes in the URL, the longer the tab will remain unresponsive.</i>
            </blockquote>
          </li>
          <li>
            Observe that the time it takes to validate each URL increases super-linearly relative to the URL length.
          </li>
        </ol>
      </p>
    </section>

    <section class="repro-content-section" ng-app="app" ng-controller="AppCtrl as $ctrl">
      <h2>Reproduction</h2>
      <p>
        Set URL to value with N trailing slashes:<br />
        <button
            ng-repeat="n in [15, 16, 17, 18, 19, 20]"
            ng-click="$ctrl.setUrlWithSlashesPowerOf2Exponent(n)">
          2^{{ n }}
        </button>
      </p>
      <p>
        <label>
          URL:
          <input
              type="url"
              ng-ref="$ctrl.urlInput"
              ng-model="$ctrl.url" />
          (length: {{ $ctrl.url.length | number }})
        </label>
      </p>
      <p>
        <button class="repro-btn" ng-click="$ctrl.validateUrl()">Validate URL</button>
        <span class="repro-duration">Time to validate URL: <b>{{ $ctrl.duration }}</b></span>
      </p>
    </section>
  </body>
</html>
